{"version":3,"sources":["meteor://ðŸ’»app/lib/routers/work.js"],"names":[],"mappings":"sBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/lib/routers/work.js","sourcesContent":["/* WORK */\n\nRouter.route(\"/work/new\", {\n\tcontroller : \"ApplicationController\",\n\tname: \"work.new\",\n\tdata : function(){\n\t\treturn this.params;\n\t},\n\taction : function () {\n\t\tSession.set(Meteor.PAGE_TITLE, \"Nouvelle fiche de travail : \"+decodeURIComponent(this.request.url.split(\"#\")[1]));\t\n\t\tthis.render(\"work-new\");\n\t}\n});\n\n\n\nRouter.route(\"/work/:workId\", {\n\tcontroller : \"ApplicationController\",\n\tname: \"work.show\",\n\tdata : function(){\n\t\tvar work = Works.findOne(this.params.workId);\n\t\tif(!work){\n\t\t\treturn;\n\t\t}\n\t\twork.pictures = Picts.find({\n\t\t\t\t\t\t\t_id : {\n\t\t\t\t\t\t\t\t$in : work.pictures||[]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.fetch()\n\t\t\t\t\t\t.map(function(pict){\n\t\t\t\t\t\t\tif(_.isString(pict.data)) return pict.data;\n\t\t\t\t\t\t\treturn Meteor.pictureServer+\"/\"+pict.data.path;\n\t\t\t\t\t\t});\n\t\twork.wikis = Wikis.find({\n\t\t\t\t\t\t_id : {\n\t\t\t\t\t\t\t$in : work.wikis||[]\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tsort :{\n\t\t\t\t\t\t\tcreatedAt : -1\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\treturn work; \n\t},\n\taction : function () {\n\t\tvar data = this.data();\n\t\tif(data){\n\t\t\tSession.set(Meteor.PAGE_TITLE, s.capitalize(data.type)+\" chez \"+s.capitalize(data.shop.name));\t\n\t\t}\n\t\tthis.render(\"work-view\");\n\t\tif(Meteor.isChief()){\n\t\t\tSession.set(Meteor.FILL_CONTEXT_MENU_KEY, true);\n\t\t\tthis.render(\"work-viewaction\", {to : \"action\"}); //contextmenu.action\n\t\t}\n\t}\n});"]}