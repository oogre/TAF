{"version":3,"sources":["meteor://ðŸ’»app/client/templates/work/edit.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/client/templates/work/edit.js","sourcesContent":["\"use strict\";\n/*global _ : false */\n/*global $ : false */\n/*global Shops : false */\n/*global Picts : false */\n/*global Router : false */\n/*global Meteor : false */\n/*global moment : false */\n/*global Session : false */\n/*global Workers : false */\n/*global console : false */\n/*global Template : false */\n\nTemplate.workEdit.destroyed = function(){\n\tSession.set(Meteor.SHOP_ID, false);\n\tSession.set(Meteor.ADD_MODULE, false);\n\tSession.set(Meteor.ADD_WORKER, false);\n\tSession.set(Meteor.ADD_MATTER, false);\n};\n\n\nTemplate.workEdit.helpers({\n\tshowTasks : function(){\n\t\tif(this && this.type === \"maintenance\" && this.modules) return true;\n\t},\n\tshowMatters : function(){\n\t\tif(this && this.type !== \"installation\") return true;\n\t},\n\tshop : function(){\n\t\tif(this && this.shop){\n\t\t\treturn Shops.findOne(this.shop._id);\n\t\t}\n\t},\n\taddModule : function(){\n\t\tif(Meteor.user() && Meteor.user().profile.role >= 90){\n\t\t\treturn Session.get(Meteor.ADD_MODULE);\t\n\t\t}\n\t},\n\taddWorker : function(){\n\t\treturn Session.get(Meteor.ADD_WORKER);\n\t},\n\taddMatter : function(){\n\t\treturn Session.get(Meteor.ADD_MATTER);\n\t},\n\tcanAddWorker : function(){\n\t\treturn Workers.find(/*{\n\t\t\t_id : {\n\t\t\t\t$nin : [] //this.worker_ids||\n\t\t\t}\n\t\t}*/).fetch();\n\t},\n\tpictureSelector : function(){\n\t\treturn {\n\t\t\tcollection : \"Works\",\n\t\t\t_id : this._id\n\t\t};\n\t}\n});\n\nTemplate.workEdit.events({\n\t\"click .moduleAdd\" : function(){\n\t\tif(Session.equals(Meteor.ADD_MODULE, true)){\n\t\t\tvar modules = Template.workmodule.modules();\n\t\t\tMeteor.call(\"workModuleTaskUpdator\", this._id, modules);\n\t\t\tSession.set(Meteor.SHOP_ID, false);\n\t\t}else{\n\t\t\tSession.set(Meteor.SHOP_ID, this.shop._id);\n\t\t}\n\t\tSession.set(Meteor.ADD_MODULE, !Session.get(Meteor.ADD_MODULE));\n\t\treturn false;\n\t},\n\t\"click .workerAdd\" : function(){\n\t\tSession.set(Meteor.ADD_WORKER, !Session.get(Meteor.ADD_WORKER));\n\t\treturn false;\n\t},\n\t\"click .matterAdd\" : function(){\n\t\tSession.set(Meteor.ADD_MATTER, !Session.get(Meteor.ADD_MATTER));\n\t\treturn false;\n\t},\n\t\"click .workClose\" : function(event){\n\t\tvar workId = $(event.target).parents(\"[data-work-id]\").first().attr(\"data-work-id\");\n\t\tMeteor.call(\"workCloser\", workId, moment().toISOString(), function(error){\n\t\t\tif(error) return console.log(error);\n\t\t\tRouter.go(\"work.show\", {workId : workId});\n\t\t});\n\t\treturn false;\n\t}\n});"]}