{"version":3,"sources":["meteor://ðŸ’»app/client/templates/worker/index.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/client/templates/worker/index.js","sourcesContent":[" \"use strict\";\n/*global s : false */\n/*global $ : false */\n/*global Works : false */\n/*global Meteor : false */\n/*global moment : false */\n/*global Workers : false */\n/*global Template : false */\n\n\n\nTemplate.workerindex.helpers({\n\tworkers : function(){\n\t\tvar self = this;\n\n\t\tif(self.origine == \"shop\"){\n\n\t\t\tvar work = Works.findOne(self.workId);\n\n\t\t\tif(!work)return [];\n\t\t\twork.schedule = work.schedule || [];\n\t\t\tvar workers = work.schedule.map(function(worker){\n\t\t\t\tworker = _.extend(worker, Workers.findOne(worker.workerId));\n\t\t\t\tvar timetable = worker.timetable || [];\n\t\t\t\tworker.working = _.last(timetable) && _.last(timetable).start && !_.last(timetable).stop;\n\t\t\t\tworker.schedular = true;\n\t\t\t\tworker.summary = self.summary;\n\t\t\t\treturn worker;\n\t\t\t});\n\n\t\t\tvar knownId = [];\n\t\t\treturn \tworkers\n\t\t\t\t\t.reverse()\n\t\t\t\t\t.map(function(worker){\n\t\t\t\t\t\tif(_.contains(knownId, worker._id)){\n\t\t\t\t\t\t\tworker.schedular = false;\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tknownId.push(worker._id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn worker;\n\t\t\t\t\t})\n\t\t\t\t\t.reverse();\n\t\t}else{\n\t\t\treturn Workers.find();\n\t\t}\n\t},\n\tisEditAndDestroyVisible : function(){\n\t\treturn Router.current().route._path == \"/worker\" && Meteor.user().profile.role >= 80;\n\t}\n});\n\n\nTemplate.workerindex.events({\n\t\"click .schedule\" : function(event){\n\t\tvar $this = $(event.target);\n\t\tvar workerId = $this.parents(\"[data-worker-id]\").first().attr(\"data-worker-id\");\n\t\tvar workId = $this.parents(\"[data-work-id]\").first().attr(\"data-work-id\");\n\t\tMeteor.call(\"workerSchedule\", workId, workerId, ($this.hasClass(\"start\") ? \"start\" : \"stop\"), moment().toISOString(), function(error){\n\t\t\tif(error) console.log(error);\n\t\t});\n\t\treturn false;\n\t}\n});\nTemplate.workeritem.helpers({\n\tisEditAndDestroyVisible : function(){\n\t\treturn Router.current().route._path == \"/worker\" && Meteor.user().profile.role >= 80;\n\t},\n\thumanizer : function(start, stop){\n\t\tvar t = \"\";\n\t\tif(!start) return t ;\n\t\tt += moment(start).format(\"DD/MM/YY HH:mm\");\n\t\tif(!stop) return t ;\n\t\tt += \" - \"+ moment(stop).format(\"DD/MM/YY HH:mm\");\n\t\treturn t ;\n\t},\n\tsummarize : function(timetable){\n\t\ttimetable = timetable || [];\n\t\tvar duration = 0 ;\n\t\tfor(var k =0 ; k < timetable.length ;k++){\n\t\t\tvar start = timetable[k].start;\n\t\t\tvar stop = timetable[k].stop || moment();\n\t\t\tduration += moment.duration(moment(stop).diff(moment(start))).asSeconds()\n\t\t}\n\t\tvar nf = function(value, len){\n\t\t\tvar t = value+\"\";\n\t\t\twhile(t.length <Â len){\n\t\t\t\tt = \"0\"+t;\n\t\t\t}\n\t\t\treturn t;\n\t\t};\n\n\t\tvar min = ((Math.ceil(duration / 60) * 60) / 60)%60;\n\t\tvar heure = Math.floor((Math.ceil(duration / 60) * 60) / 60 /60);\n\t\t\n\t\treturn nf(heure, 2)+\":\"+nf(min, 2);\n\t}\n});"]}