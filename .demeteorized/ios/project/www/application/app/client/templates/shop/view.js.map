{"version":3,"sources":["meteor://üíªapp/client/templates/shop/view.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/client/templates/shop/view.js","sourcesContent":["\"use strict\";\n/*global _ : false */\n/*global Modules : false */\n/*global Template : false */\n\n\nTemplate.shopview.created = function(){\n\tSession.set(Meteor.LIST_CALENDAR_SWITCHER, true);\n}\nTemplate.shopview.rendered = function(){\n\t\n}\nTemplate.shopview.destroyed = function(){\n\tSession.set(Meteor.LIST_CALENDAR_SWITCHER, false);\t\n}\n\nTemplate.shopview.events({\n\t\"click .workToPdf\" : function(event){\n\t\tvar workId = $(event.target).attr(\"data-work-id\");\n\n\t\tMeteor.call(\"workToPdf\", workId, function(err, file){\n\t\t\tif(err)console.error(err);\n\t\t\twindow.open(file);\n\t\t});\n\t},\n\t\"click .maintenanceToPdf\" : function(event){\n\t\tvar workId = $(event.target).attr(\"data-work-id\");\n\n\t\tMeteor.call(\"maintenanceToPdf\", workId, function(err, file){\n\t\t\tif(err)console.error(err);\n\t\t\twindow.open(file);\n\t\t});\n\t},\n})\nTemplate.shopview.helpers({\n\tlocation : function(){\n\t\treturn this.location;\n\t},\n\tmodules : function(){\n\t\tif(this.modules){\n\t\t\treturn\t_\n\t\t\t\t\t.chain(\n\t\t\t\t\t\tthis.modules\n\t\t\t\t\t)\n\t\t\t\t\t.groupBy(function(module){\n\t\t\t\t\t\tif(module)\n\t\t\t\t\t\t\treturn module.type;\n\t\t\t\t\t})\n\t\t\t\t\t.map(function(modules,key){\n\t\t\t\t\t\tif(modules)\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\ttype: key, \n\t\t\t\t\t\t\t\tmodules: modules.map(function(module){\n\t\t\t\t\t\t\t\t\tmodule.view = true;\n\t\t\t\t\t\t\t\t\treturn module;\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t};\n\t\t\t\t\t})\n\t\t\t\t\t.sortBy(function(modules){\n\t\t\t\t\t\tif(modules)\n\t\t\t\t\t\t\treturn modules.type;\n\t\t\t\t\t})\n\t\t\t\t\t.value();\n\t\t}\n\t},\n\tworks : function(){\n\t\tvar tmp = _\n\t\t\t\t.chain(\n\t\t\t\t\tWorks\n\t\t\t\t\t.find({\n\t\t\t\t\t\t\"shop._id\" : this._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\tsort : {\n\t\t\t\t\t\t\trdv : -1\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.fetch()\n\t\t\t\t)\n\t\t\t\t.map(function(work){\n\t\t\t\t\twork.rdv = moment(work.rdv).format(\"DD/MM/YY HH:mm\");\n\t\t\t\t\treturn work;\n\t\t\t\t})\n\t\t\t\t.groupBy(function(work){\n\t\t\t\t\treturn work.end;\n\t\t\t\t})\n\t\t\t\t.value();\n\t\t\t\tvar unfinished = tmp.undefined || [];\n\t\t\t\tvar torun = [];\n\t\t\t\tunfinished = \tunfinished\n\t\t\t\t\t\t\t\t.map(function(work){\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif( _\n\t\t\t\t\t\t\t\t\t\t.chain(work.schedular)\n\t\t\t\t\t\t\t\t\t\t.keys()\n\t\t\t\t\t\t\t\t\t\t.map(function(worker){\n\t\t\t\t\t\t\t\t\t\t\treturn  work.schedular[worker].length > 0;\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t.some()\n\t\t\t\t\t\t\t\t\t\t.value()\n\t\t\t\t\t\t\t\t\t){\n\t\t\t\t\t\t\t\t\t\treturn work;\n\t\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\t\ttorun.push(work);\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\tunfinished = _.compact(unfinished)\n\n\t\t\t\tdelete tmp.undefined;\t\t\n\t\treturn{\n\t\t\ttorun : torun.reverse(),\n\t\t\tunfinished : unfinished,\n\t\t\tfinished : \t_\n\t\t\t\t\t\t.chain(tmp)\n\t\t\t\t\t\t.values()\n\t\t\t\t\t\t.flatten()\n\t\t\t\t\t\t.map(function(work){\n\t\t\t\t\t\t\twork.depannage = work.type == \"d√©pannage\";\n\t\t\t\t\t\t\twork.installation = work.type == \"installation\";\n\t\t\t\t\t\t\twork.entretien = work.type == \"maintenance\";\n\t\t\t\t\t\t\treturn work;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.value()\n\t\t};\n\t\t\n\t\t\n\t\t\t\t; \n\t},\n});"]}