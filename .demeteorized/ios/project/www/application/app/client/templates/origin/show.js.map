{"version":3,"sources":["meteor://ðŸ’»app/client/templates/origin/show.js"],"names":[],"mappings":"YAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"/client/templates/origin/show.js","sourcesContent":["\nvar shop, module, origine, work;\nTemplate.originshow.helpers({\n\tvalue : function(){\n\t\tconsole.log(this);\n\t},\n\tformatize : function(dateTime){\n\t\treturn moment(dateTime).format(\"DD MMM YYYY\");\n\t},\n\tsetCurrent : function(destinyId){\n\t\torigine = false;\n\t\tmodule = false;\n\t\twork = Works.findOne(this.workId);\n\t\tif(work){\n\t\t\tshop = \tShops.findOne(work.shop._id);\n\t\t}else{\n\t\t\tshop = \tShops.findOne({\n\t\t\t\t\t\t'modules.0.serial' : destinyId\n\t\t\t\t\t});\n\t\t}\n\t\t\n\t\tif(shop){\n\t\t\tmodule = _.find(shop.modules, function(item){\n\t\t\t\t\t\treturn item.serial == destinyId;\n\t\t\t\t\t});\n\t\t}else{\n\t\t\torigine = Origins.findOne(destinyId);\n\t\t}\n\t},\n\twork : function(){\n\t\treturn work;\n\t},\n\tshop : function(){\n\t\treturn shop;\n\t},\n\tmodule : function(){\n\t\treturn module;\n\t},\n\torigine : function(){\n\t\treturn origine;\n\t},\n\tdestins : function(){\n\t\t\n\t\treturn Origins.find({\n\t\t\tmatter : this.matter._id,\n\t\t\t_id : {\n\t\t\t\t$not : this.origin._id\n\t\t\t}\n\t\t}).fetch();\n\t}\n});\nfunction sendmatterOriginsTransfert(matter){\n\tMeteor.call(\"matterOriginsTransfert\", {\n\t\t\t\t\t\tworkId : null,\n\t\t\t\t\t\tquantity : matter.quantity,\n\t\t\t\t\t\tdestinyId : matter.destiny,\n\t\t\t\t\t\toriginId : matter.origin,\n\t\t\t\t\t\tdateTime : moment().toISOString()\n\t\t\t\t\t});\n\tSession.set(Meteor.MATTER, false);\n}\n\nTemplate.originshow.events({\n\t\"blur input[name='quantity']\" : function(event){\n\t\tvar matter = Session.get(Meteor.MATTER)||{};\n\t\tmatter.quantity = event.target.value.toLowerCase();\n\t\tmatter.origin = this.origin._id;\n\t\tSession.set(Meteor.MATTER, matter);\n\t\tif(matter.quantity && matter.destiny){\n\t\t\tsendmatterOriginsTransfert(matter);\n\t\t\t$(\"input[name='quantity'], select[name='destiny']\").val(\"\");\n\t\t}\t\t\n\t},\n\t\"change select[name='destiny']\" : function(event){\n\t\tvar self = this;\n\t\tif(Meteor.isCordova && event.target.value == \"barcode\"){\n\t\t\tcordova.plugins.barcodeScanner.scan(\n\t\t\t\tfunction (result) {\n\t\t\t\t\t$(event.target)\n\t\t\t\t\t.find(\"option\")\n\t\t\t\t\t.each(function(k, elem){\n\t\t\t\t\t\tif($(elem).html() == result.text){\n\t\t\t\t\t\t\t$(event.target).val($(elem).val());\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar matter = Session.get(Meteor.MATTER)||{};\n\t\t\t\t\t\t\tmatter.destiny = $(elem).val();\n\t\t\t\t\t\t\tmatter.origin = self.origin._id;\n\t\t\t\t\t\t\tSession.set(Meteor.MATTER, matter);\n\t\t\t\t\t\t\tif(matter.quantity && matter.destiny){\n\t\t\t\t\t\t\t\tsendmatterOriginsTransfert(matter);\n\t\t\t\t\t\t\t\t$(\"input[name='quantity'], select[name='destiny']\").val(\"\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}, \n\t\t\t\tfunction (error) {\n\t\t\t\t\talert(\"Scanning failed: \" + error);\n\t\t\t\t}\n\t\t\t);\n\t\t}else{\n\t\t\tvar matter = Session.get(Meteor.MATTER)||{};\n\t\t\tmatter.destiny = event.target.value;\n\t\t\tmatter.origin = this.origin._id;\n\t\t\tSession.set(Meteor.MATTER, matter);\n\t\t\tif(matter.quantity && matter.destiny){\n\t\t\t\tsendmatterOriginsTransfert(matter);\n\t\t\t\t$(\"input[name='quantity'], select[name='destiny']\").val(\"\");\n\t\t\t}\n\t\t}\t\t\n\t}\n});\nTemplate.originshow.destroyed = function(){\n\tSession.set(Meteor.MATTER, false);\n};\nTemplate.originshow.rendered = function(){\n\tSession.set(Meteor.MATTER, false);\t\n};\n\n"]}