{"version":3,"sources":["meteor://ðŸ’»app/client/templates/work/tasks.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E","file":"/client/templates/work/tasks.js","sourcesContent":["\"use strict\";\n/*global _ : false */\n/*global $ : false */\n/*global Works : false */\n/*global Shops : false */\n/*global Meteor : false */\n/*global Session : false */\n/*global Template : false */\n\n\nTemplate.workmodules.helpers({\n\tworkModules : function(){\n\n\t\tif(this.shop && this.shop.modules){\n\t\t\tvar shopId = this.shop._id;\n\t\t\treturn (this\n\t\t\t\t\t.shop\n\t\t\t\t\t.modules ||Â [])\n\t\t\t\t\t.map(function(module, key){\n\t\t\t\t\t\tmodule.key = key;\n\t\t\t\t\t\tmodule.shopId = shopId;\n\t\t\t\t\t\treturn module;\n\t\t\t\t\t});\n\t\t}else if(this.work && this.work.modules){\n\t\t\tvar workId = this.work._id;\n\t\t\tvar abortUpdateTask = this.abortUpdateTask;\n\t\t\treturn \t(this\n\t\t\t\t\t.work\n\t\t\t\t\t.modules ||Â [])\n\t\t\t\t\t.map(function(module, key){\n\t\t\t\t\t\tmodule.key = key;\n\t\t\t\t\t\tmodule.workId = workId;\n\t\t\t\t\t\tmodule.tasks = module.tasks.map(function(task){\n\t\t\t\t\t\t\ttask.moduleKey = module.key;\n\t\t\t\t\t\t\ttask.workId = workId;\n\t\t\t\t\t\t\ttask.abortUpdateTask = abortUpdateTask;\n\t\t\t\t\t\t\treturn task;\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn module;\n\t\t\t\t\t});\n\t\t}\n\t}\n});\nTemplate.workmodules.destroyed = function(){\n\tSession.set(Meteor.TASK_SELECTED, {});\n\tSession.set(Meteor.MODULE_SELECTED, false);\n};\nTemplate.workmodules.rendered = function(){\n\tvar self = this;\n\tif(self.data.work && self.data.shop){\n\t\tvar keys = _.pluck(self.data.work.modules, \"moduleKey\");\n\t\tSession.set(Meteor.MODULE_SELECTED, keys);\n\t\t\n\t\tvar tasks = Session.get(Meteor.TASK_SELECTED);\n\t\tkeys.map(function(key){\n\t\t\ttasks[\"module_\"+key] = \t_\n\t\t\t\t\t\t\t\t\t.pluck(\t_\n\t\t\t\t\t\t\t\t\t\t\t.find(\tself.data.work.modules, \n\t\t\t\t\t\t\t\t\t\t\t\t\tfunction(module){\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn module.moduleKey == key;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t).tasks, \n\t\t\t\t\t\t\t\t\t\t\t\"_id\"\n\t\t\t\t\t\t\t\t\t);\n\t\t});\n\t\tSession.set(Meteor.TASK_SELECTED, tasks);\n\t}\n};\n\nTemplate.workmodule.helpers({\n\ttaskCompleted : function(){\n\t\tif(this.workId){\n\t\t\treturn _.every(_.pluck(this.tasks, \"checked\"), _.identity) ? \"completed\" : \"\";\n\t\t}\n\t},\n\tkey : function(){\n\t\treturn \"\"+this.key;\n\t},\n\ttaskIds : function(){\n\t\treturn Session.get(Meteor.TASK_SELECTED)[\"module_\"+this.key];\n\t},\n\tmoduleSelected : function(){\n\t\treturn (this.shopId && Session.equals(Meteor.ADD_MODULE, true) && _.contains((Session.get(Meteor.MODULE_SELECTED)||[]), \"\"+this.key)) ? \"selected\" : false;\n\t},\n\tmoduleOpened : function(){\n\t\treturn (this.workId && Session.equals(Meteor.ADD_MODULE, false) && Session.equals(Meteor.MODULE_SELECTED, \"\"+this.key)) ? \"open\" : false;\n\t},\n\tdisabled : function(){\n\t\treturn this.abortUpdateTask ? \"disabled\" : \"\";\n\t},\n\tchecked : function(moduleKey, taskId){\n\t\tvar work = Works.findOne(this.workId);\n\t\tif(work && work.modules && work.modules[moduleKey] && work.modules[moduleKey].tasks){\n\t\t\tvar task = _.find(work.modules[moduleKey].tasks, function(task){\n\t\t\t\treturn task._id == taskId;\n\t\t\t});\n\t\t\tif(task){\n\t\t\t\treturn _.isString(task.checked) ? task.checked : (task.checked === true ? \"checked\" : \"\");\n\t\t\t}\n\t\t}\n\t}\n});\n\nTemplate.workmodule.events({\n\t\"click .module header\" : function(){\n\t\tvar tasks;\n\t\tif(Session.equals(Meteor.ADD_MODULE, true)){\n\t\t\tif(_.contains((Session.get(Meteor.MODULE_SELECTED)||[]), \"\"+this.key)){\n\t\t\t\tSession.set(Meteor.MODULE_SELECTED, _.without(Session.get(Meteor.MODULE_SELECTED), \"\"+this.key));\n\t\t\t\t\n\t\t\t\ttasks = Session.get(Meteor.TASK_SELECTED);\n\t\t\t\tdelete tasks[\"module_\"+this.key];\n\t\t\t\tSession.set(Meteor.TASK_SELECTED, tasks);\n\t\t\t}else{\n\t\t\t\tSession.set(Meteor.MODULE_SELECTED, (Session.get(Meteor.MODULE_SELECTED)||[]).concat(\"\"+this.key));\n\t\t\t\t\n\t\t\t\ttasks = Session.get(Meteor.TASK_SELECTED);\n\t\t\t\ttasks[\"module_\"+this.key] = [];\n\t\t\t\tSession.set(Meteor.TASK_SELECTED, tasks);\n\t\t\t}\n\t\t}else{\n\t\t\tif(Session.equals(Meteor.MODULE_SELECTED, \"\"+this.key)){\n\t\t\t\tSession.set(Meteor.MODULE_SELECTED, false);\n\t\t\t\ttasks = Session.get(Meteor.TASK_SELECTED);\n\t\t\t\tdelete tasks[\"module_\"+this.key];\n\t\t\t\tSession.set(Meteor.TASK_SELECTED, tasks);\n\t\t\t}else{\n\t\t\t\tSession.set(Meteor.MODULE_SELECTED, \"\"+this.key);\n\t\t\t\t\n\t\t\t\ttasks = Session.get(Meteor.TASK_SELECTED);\n\t\t\t\ttasks[\"module_\"+this.key] = [];\n\t\t\t\tSession.set(Meteor.TASK_SELECTED, tasks);\n\n\t\t\t\tvar hash = \"#\"+this.key;\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tlocation.hash = hash;\n\t\t\t\t}, 200);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn false;\n\t},\n\t\"click .module button.checkbox\" : function(event){\n\t\tvar target = $(event.target);\n\t\tvar id = target.attr(\"id\") ? target.attr(\"id\") : target.parent().attr(\"id\");\n\t\tvar moduleKey_taskId = id.split(\"_\");\n\t\tvar taskId = moduleKey_taskId.pop();\n\t\tvar moduleKey = moduleKey_taskId.pop();\n\t\tMeteor.call(\"workTaskChecker\", this.workId, moduleKey, taskId, false);\n\t\treturn false;\n\t},\n\t\"blur .module input[name='checkbox']\" : function(event){\n\t\tvar moduleKey_taskId = $(event.target).attr(\"id\").split(\"_\");\n\t\tvar taskId = moduleKey_taskId.pop();\n\t\tvar moduleKey = moduleKey_taskId.pop();\n\t\tvar value = _.isString($(event.target).val()) ? $(event.target).val() : false;\n\t\tMeteor.call(\"workTaskChecker\", this.workId, moduleKey, taskId, value);\n\t\treturn false;\n\t}\n});\n\nTemplate.workmodule.modules = function(){\n\tvar shop = Shops.findOne(Session.get(Meteor.SHOP_ID));\n\treturn \tTemplate\n\t\t\t.taskselector\n\t\t\t.tasks()\n\t\t\t.map(function(module){\n\t\t\t\treturn _.extend(shop.modules[module.moduleKey], module);\n\t\t\t});\n};"]}