{"version":3,"sources":["meteor://ðŸ’»app/lib/methods/wiki.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/lib/methods/wiki.js","sourcesContent":["\"use strict\";\n/*global $ : false */\n/*global Wikis : false */\n/*global Works : false */\n/*global moment : false */\n/*global Meteor : false */\n/*global global : false */\n\n\nMeteor.methods({\n\twikiCreator : function(workId, wiki){\n\t\tif (! Meteor.userId()) {\n\t\t\treturn new Meteor.Error(\"not-authorized\");\n\t\t}\n\t\tthis.unblock();\n\t\tif(!wiki.description){\n\t\t\treturn;\n\t\t}\n\t\tvar currentWiki = Wikis.insert({\n\t\t\tcreatedAt : moment().toISOString(),\n\t\t\tdescription : wiki.description,\n\t\t\tlinkTo : {\n\t\t\t\tcollection : \"Works\",\n\t\t\t\t_id : workId\n\t\t\t}\n\t\t});\n\t\tif(workId){\n\t\t\tWorks.update(workId, {\n\t\t\t\t$push : {\n\t\t\t\t\twikis : currentWiki\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif(this.isSimulation){\n\t\t\t$(\"textarea\").val(\"\");\n\t\t}\n\t\treturn currentWiki;\n\t},\n\twikiDestroyer : function(id){\n\t\tif (! Meteor.userId()) {\n\t\t\treturn new Meteor.Error(\"not-authorized\");\n\t\t}\n\t\tthis.unblock();\n\n\t\tvar wiki = Wikis.findOne(id);\n\t\tif(!wiki){\n\t\t\treturn false;\n\t\t}\n\t\tif(wiki.linkTo && wiki.linkTo._id && wiki.linkTo.collection){\n\n\t\t\tvar Collection;\n\t\t\tif(Meteor.isClient){\n\t\t\t\tCollection = window[wiki.linkTo.collection];\t\n\t\t\t} \n\t\t\telse{\n\t\t\t Collection = global[wiki.linkTo.collection];\n\t\t\t}\n\n\t\t\tCollection\n\t\t\t.update(wiki.linkTo._id, {\n\t\t\t\t$pull : {\n\t\t\t\t\twikis : id\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn Wikis.remove(id);\n\t}\n});"]}