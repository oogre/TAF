{"version":3,"sources":["meteor://ðŸ’»app/client/templates/worker/index.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/client/templates/worker/index.js","sourcesContent":[" \"use strict\";\n/*global s : false */\n/*global $ : false */\n/*global Works : false */\n/*global Meteor : false */\n/*global moment : false */\n/*global Workers : false */\n/*global Template : false */\n\nTemplate.workerindex.helpers({\n\tworkers : function(){\n\t\tvar self = this;\n\t\tif(!this.worker_ids)return [];\n\t\tvar work = Works.findOne(self.workId);\n\t\treturn \tWorkers\n\t\t\t\t.find({\n\t\t\t\t\t_id : {\n\t\t\t\t\t\t$in : this.worker_ids\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.fetch()\n\t\t\t\t.map(function(worker){\n\t\t\t\t\tif(self.schedular){\n\t\t\t\t\t\tworker.schedular = self.schedular;\n\t\t\t\t\t\tif(work.schedular && work.schedular[worker._id]){\n\t\t\t\t\t\t\tvar current = work.schedular[worker._id].pop();\n\t\t\t\t\t\t\tworker.working = current ? !current.stop : false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(self.schedularSummary){\n\t\t\t\t\t\tvar currentDuration =\tmoment.duration();\n\t\t\t\t\t\tif(work.schedular && work.schedular[worker._id]){\n\t\t\t\t\t\t\twork\n\t\t\t\t\t\t\t.schedular[worker._id]\n\t\t\t\t\t\t\t.map(function(schedule){\n\t\t\t\t\t\t\t\treturn moment(schedule.stop).diff(moment(schedule.start));\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.map(function(duration){\n\t\t\t\t\t\t\t\tcurrentDuration.add(duration);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tworker.schedularSummary = s.pad(Math.floor(currentDuration.asHours()), 2, \"0\")+\":\"+s.pad(currentDuration.minutes(), 2, \"0\");\n\t\t\t\t\t}\n\t\t\t\t\treturn worker;\n\t\t\t\t});\n\t}\n});\n\nTemplate.workerindex.events({\n\t\"click .schedule\" : function(event){\n\t\tvar $this = $(event.target);\n\t\tvar workerId = $this.parents(\"[data-worker-id]\").first().attr(\"data-worker-id\");\n\t\tvar workId = $this.parents(\"[data-work-id]\").first().attr(\"data-work-id\");\n\t\tMeteor.call(\"workerSchedule\", workId, workerId, ($this.hasClass(\"start\") ? \"start\" : \"stop\"), moment().toISOString(), function(error){\n\t\t\tif(error) console.log(error);\n\t\t});\n\t\treturn false;\n\t}\n});\nTemplate.workeritem.helpers({\n\tactions : function(){\n\t\treturn !this.schedularSummary && !this.schedular && Meteor.user().profile.role >= 80;\n\t}\n});"]}