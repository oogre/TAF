{"version":3,"sources":["meteor://ðŸ’»app/client/templates/calendar/calendar.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E","file":"/client/templates/calendar/calendar.js","sourcesContent":["\"use strict\";\n/*global $ : false */\n/*global Deps : false */\n/*global Works : false */\n/*global Router : false */\n/*global moment : false */\n/*global Meteor : false */\n/*global Session : false */\n/*global Template : false */\n\nvar getWorks = function (start, end) {\n\tstart = start.subtract(1, \"day\").toISOString();\n\tend = end.toISOString();\n\treturn Works.find({\n\t\t$or : [{\n\t\t\t\trdv : {\n\t\t\t\t\t$gte: start,\n\t\t\t\t\t$lte: end\n\t\t\t\t}\n\t\t\t},{\n\t\t\t\tend : {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t},{\n\t\t\t\tend : \"\"\n\t\t\t},{\n\t\t\t\tend : {\n\t\t\t\t\t$gte: start,\n\t\t\t\t\t$lte: end\n\t\t\t\t}\n\t\t\t}]\n\t})\n\t.fetch();\n};\nvar mapWorkToEvent = function (works) {\n\treturn \tworks\n\t\t\t.map(function (work) {\n\t\t\t\tvar color;\n\t\t\t\tswitch(work.type){\n\t\t\t\t\tcase \"installation\":\n\t\t\t\t\t\tcolor = \"#3A51AD\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"maintenance\":\n\t\t\t\t\t\tcolor = \"#6D3AAD\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcolor = \"#AD433A\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(work && work.signatures && work.signatures.client && work.signatures.adf ){\n\t\t\t\t\tcolor = \"#9F9F9F\";\n\t\t\t\t}\n\t\t\t\telse if(work.end){\n\t\t\t\t\tcolor = \"#333\";\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\ttitle: work.shop.name,\n\t\t\t\t\tstart: work.rdv,\n\t\t\t\t\tend: work.end || moment().toISOString(),\n\t\t\t\t\tcolor: color,\n\t\t\t\t\tid : work._id\n\t\t\t\t};\n\t\t\t});\n};\n\nTemplate.calendar.rendered = function () {\n\t$(\"#calendar\").fullCalendar({\n\t\ttimezone : \"local\",\n\t\theight: $(window).height() - $(\"#calendar\").offset().top,\n\t\tdefaultDate : Session.get(Meteor.CALENDAR_CONF).defaultDate,\n\t\tdefaultView : Session.get(Meteor.CALENDAR_CONF).defaultView,\n\t\theader: {\n\t\t\tcenter: \"prev title next\",\n\t\t\tleft : \"month,basicDay\",\n\t\t\tright: \"today\"\n\t\t},\n\t\tlang : \"fr\",\n\t\teditable: false,\n\t\tevents: function (start, end, timezone, next) {\n\t\t\tvar works = getWorks(start, end);\n\t\t\tnext(mapWorkToEvent(works));\n\t\t},\n\t\teventClick: function(calEvent) {\n\t\t\tRouter.go(\"work.show\", {\n\t\t\t\tworkId:calEvent.id\n\t\t\t});\n\t\t},\n\t\teventAfterAllRender : function(view){\n\t\t\tSession.set(Meteor.CALENDAR_CONF, {\n\t\t\t\tdefaultView : view.name,\n\t\t\t\tdefaultDate : view.calendar.getDate().format()\n\t\t\t});\n\t\t}\n\t});\n\n\tDeps.autorun(function(c) {\n\t\tif (Works.find().count()) {\n\t\t\tif(!c.firstRun){\n\t\t\t\tif($(\"#calendar\").length){\n\t\t\t\t\t$(\"#calendar\").fullCalendar(\"refetchEvents\");\n\t\t\t\t}else{\n\t\t\t\t\tc.stop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};"]}