{"version":3,"sources":["meteor://ðŸ’»app/lib/methods/shops.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"/lib/methods/shops.js","sourcesContent":["\"use strict\";\n/*global _ : false */\n/*global $ : false */\n/*global Shops : false */\n/*global Router : false */\n/*global Meteor : false */\n/*global Modules : false */\n\nMeteor.methods({\n\teasyShopCreator : function(shop){\n\t\tif (! Meteor.userId()) {\n\t\t\treturn new Meteor.Error(\"not-authorized\");\n\t\t}\n\t\tif(!shop.name || !shop.contacts ||Â !shop.contacts.length){\n\t\t\treturn new Meteor.Error(\"name-contact-minimal-data\");\n\t\t}\t\n\t\tthis.unblock();\n\t\treturn Shops.insert(shop);\n\t},\n\tshopCreator : function(shop, button){\n\t\tif (! Meteor.userId()) {\n\t\t\treturn new Meteor.Error(\"not-authorized\");\n\t\t}\n\n\t\tif(!shop.name || !shop.contacts ||Â !shop.contacts.length){\n\t\t\treturn new Meteor.Error(\"name-contact-minimal-data\");\n\t\t}\n\n\t\tthis.unblock();\n\t\tif(!Shops.findOne({name : shop.name})){\n\t\t\tvar shopId = Shops.insert(shop);\n\n\t\t\tif(Meteor.isServer && shop.address.street && shop.address.number && shop.address.city && shop.address.zipcode){\n\t\t\t\tMeteor.geocode(shop.address.street+\" \"+shop.address.number+\" \"+shop.address.city+\" \"+shop.address.zipcode, function(error, location){\n\t\t\t\t\tif(error)return ;\n\t\t\t\t\tshop.location = location;\n\n\t\t\t\t\tShops.update(shopId, shop);\t\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tif(this.isSimulation){\n\t\t\t\t$(button)\n\t\t\t\t.removeClass(\"btn-primary\")\n\t\t\t\t.addClass(\"btn-success\");\n\t\t\t\tRouter.go(\"shop.index\");\n\t\t\t}\n\t\t\treturn shopId;\n\t\t}\n\t},\n\tshopDestroyer: function (shopId) {\n\t\tif (! Meteor.userId()) {\n\t\t\treturn new Meteor.Error(\"not-authorized\");\n\t\t}\n\t\tthis.unblock();\n\t\treturn Shops.remove(shopId);\n\t},\n\tshopUpdateTimeDist : function(shopId, time){\n\t\tif (! Meteor.userId()) {\n\t\t\treturn new Meteor.Error(\"not-authorized\");\n\t\t}\n\t\tthis.unblock();\n\t\tShops.update(shopId, {\n\t\t\t$set : {\n\t\t\t\ttimeDist : time\n\t\t\t}\n\t\t});\n\t\treturn true;\n\t},\n\tshopUpdator : function(shopId, shop, button){\n\t\tif (! Meteor.userId()) {\n\t\t\treturn new Meteor.Error(\"not-authorized\");\n\t\t}\n\t\tif(!shop.name || !shop.contacts ||Â !shop.contacts.length){\n\t\t\treturn new Meteor.Error(\"name-contact-minimal-data\");\n\t\t}\n\n\t\tthis.unblock();\n\t\tif(!Shops.findOne({_id : {$ne : shopId},name : shop.name})){\n\n\t\t\tShops.update(shopId, shop);\n\n\t\t\tif(Meteor.isServer && shop.address.street && shop.address.number && shop.address.city && shop.address.zipcode){\n\n\t\t\t\tMeteor.geocode(shop.address.street+\" \"+shop.address.number+\" \"+shop.address.city+\" \"+shop.address.zipcode, function(error, location){\n\t\t\t\t\tif(error){\n\t\t\t\t\t\tconsole.error(\"location error\");\t\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\t\n\t\t\t\t\tshop.location = location;\n\t\t\t\t\tShops.update(shopId, shop);\t\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif(this.isSimulation){\n\t\t\t\t$(button)\n\t\t\t\t.removeClass(\"btn-primary\")\n\t\t\t\t.addClass(\"btn-success\");\n\t\t\t\tRouter.go(\"shop.index\");\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t},\n\tshopAddModule : function(shopId, moduleId){\n\t\tShops.update(shopId, {\n\t\t\t$push : {\n\t\t\t\tmodules : Modules.findOne(moduleId)\n\t\t\t}\n\t\t});\n\t\treturn true;\n\t},\n\tshopModuleUpdator : function(shopId, key, module){\n\t\tvar updator = {};\n\t\t_.map(module, function(module, k) {\n\t\t\tupdator[\"modules.\"+key+\".\"+k] = module;\n\t\t});\n\t\tShops.update(shopId, {\n\t\t\t$set : updator\n\t\t});\n\t},\n\tshopModuleDestroyer : function(data){\n\t\tvar shop = Shops.findOne(data.shopId);\n\t\tshop.modules.splice(data.key, 1);\n\t\tconsole.log(\"PAY ATTENTION TO work.modules.tasks && work.modulesMatter.matter\");\n\t\tShops.update(data.shopId, {\n\t\t\t$set : {\n\t\t\t\tmodules : shop.modules\n\t\t\t}\n\t\t});\n\t},\n\tshopModuleTask: function(shopId, moduleId, key, taskId){\n\t\tvar selector = {\n\t\t\t_id : shopId\n\t\t};\n\t\tselector[\"modules.\"+key+\".id\"] = moduleId;\n\t\t\n\t\tvar updator = {};\n\t\tupdator[\"modules.\"+key+\".tasks\"] = taskId;\n\n\t\tShops.update(selector, {\n\t\t\t$set : updator\n\t\t});\n\n\t\treturn false;\n\t},\n\tcheckTVA : function(tva){\n\t\tthis.unblock();\n\t\tif(Meteor.isServer){\n\t\t\treturn Meteor.checkTVA(tva);\n\t\t}\n\t}\n});\n"]}