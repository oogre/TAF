{"version":3,"sources":["meteor://ðŸ’»app/server/init.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/server/init.js","sourcesContent":["\"use strict\";\n/*global Meteor : false */\n/*global Roles : false */\n/*global Tasks : false */\n/*global Shops : false */\n/*global Wikis : false */\n/*global Units : false */\n/*global Works : false */\n/*global Picts : false */\n/*global Matters : false */\n/*global Modules : false */\n/*global process : false */\n/*global UploadServer : false */\n\n\n\nvar uploadServerInit = function(){\n\tUploadServer.init({\n\t\ttmpDir : process.env.PWD + \"/.uploads/tmp\",\n\t\tuploadDir : process.env.PWD + \"/.uploads/\",\n\t\tminFileSize : 20,\n\t\tcheckCreateDirectories : true, //create the directories for you\n\t\tgetDirectory: function(fileInfo, formData) {\n\t\t\tif (formData && formData.directoryName) {\n\t\t\t\treturn formData.directoryName;\n\t\t\t}\n\t\t\treturn \"\";\n\t\t},\n\t\tgetFileName: function(fileInfo, formData) {\n\t\t\tvar ext = fileInfo.type.split(\"/\").pop();\n\t\t\tvar filename = (new Date()).getTime() + \".\" + ext;\n\t\t\tif (formData && formData._id) filename = formData._id + \"-\" + filename;\n\t\t\tif (formData && formData.prefix) filename = formData.prefix + \"-\" + filename;\n\t\t\treturn filename;\n\t\t},\n\t\tfinished: function(fileInfo, formData) {\n\t\t\tif (formData && formData._id) {\n\t\t\t\tif(formData.next === \"workSignature\"){\n\t\t\t\t\tMeteor.call(\"workSignature\", formData._id, formData.prefix, fileInfo);\n\t\t\t\t}else{\n\t\t\t\t\tMeteor.call(\"pictureCreator\", fileInfo, {\n\t\t\t\t\t\tcollection : formData.collection,\n\t\t\t\t\t\t_id : formData._id,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nvar rolesInit = function(){\n\tif(Roles.find().count() === 0 ){\n\t\tRoles.insert({\n\t\t\tlevel : 100,\n\t\t\tname : \"administrator\"\n\t\t});\n\t\tRoles.insert({\n\t\t\tlevel : 90,\n\t\t\tname : \"boss\"\n\t\t});\n\t\tRoles.insert({\n\t\t\tlevel : 80,\n\t\t\tname : \"chef\"\n\t\t});\n\t\tRoles.insert({\n\t\t\tlevel : 60,\n\t\t\tname : \"travailleur\"\n\t\t});\n\t\tRoles.insert({\n\t\t\tlevel : 50,\n\t\t\tname : \"visiteur\"\n\t\t});\n\t}\t\n};\n\nvar unitsInit = function(){\n\tif(Units.find().count() === 0 ){\n\t\tUnits.insert({\n\t\t\tname : \"gramme\",\n\t\t\tshortname : \"g\"\n\t\t});\n\t\tUnits.insert({\n\t\t\tname : \"kilogramme\",\n\t\t\tshortname : \"kg\"\n\t\t});\n\t\tUnits.insert({\n\t\t\tname : \"litre\",\n\t\t\tshortname : \"l\"\n\t\t});\n\t\tUnits.insert({\n\t\t\tname : \"centimÃ¨tre\",\n\t\t\tshortname : \"cm\"\n\t\t});\n\t\tUnits.insert({\n\t\t\tname : \"mÃ¨tre\",\n\t\t\tshortname : \"m\"\n\t\t});\n\t}\t\n};\n\nvar expandItmModuleToAllITMShop = function(){\n\tvar modules = Shops.findOne(\"ifhkrkmHQaY47e4iW\").modules;\n\tShops.find({\n\t\tname:/.*itm.*/\n\t})\n\t.fetch()\n\t.map(function(shop){\n\t\tif(shop._id === \"ifhkrkmHQaY47e4iW\")return ;\n\t\tShops.update(shop._id, {\n\t\t\t$set : {\n\t\t\t\tmodules : modules\n\t\t\t}\n\t\t});\n\t});\n};\n\nvar clean = function(){\n\tModules.remove({});\n\tMatters.remove({});\n\tWorks.remove({});\n\tPicts.remove({});\n\tTasks.remove({});\n\tWikis.remove({});\n};\n\nWebApp.connectHandlers.use(function(req, res, next) {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  return next();\n});\n\n\nMeteor.startup(function () {\n\tuploadServerInit();\n\trolesInit();\n\tunitsInit();\n\tprocess.env.KEY_GOOGLE = process.env.KEY_GOOGLE || \"AIzaSyCVOeZt_PwTAqSjIv-7DBc5JZCuiZTp-Co\";\n});"]}