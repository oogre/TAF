{"version":3,"sources":["meteor://ðŸ’»app/server/methods.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/server/methods.js","sourcesContent":["\"use strict\";\n/*global _ : false */\n/*global s : false */\n/*global Npm : false */\n/*global Works : false */\n/*global Wikis : false */\n/*global Shops : false */\n/*global Meteor : false */\n/*global moment : false */\n/*global Workers : false */\n/*global process : false */\n\n\n// meteor run android-device --mobile-server http://ogre.local:3000\n\nMeteor.methods({\n\tgetServerIp : function(){\n\t\tthis.unblock();\n\t\tvar Future = Npm.require(\"fibers/future\");\n\t\tvar myFuture = new Future();\n\t\tvar exec = Npm.require(\"child_process\").exec;\n\t\texec(\"ifconfig\", function (error, stdout) {\n\t\t\ttry{\n\t\t\t\tstdout = stdout.split(\"en1\").pop();\n\t\t\t\tstdout = stdout.split(\"en2\").shift();\n\t\t\t\tstdout = stdout.split(\"inet \").pop();\n\t\t\t\tmyFuture.return(stdout.split(\" netmask\").shift());\n\t\t\t}catch(e){\n\t\t\t\tmyFuture.return(\"\");\n\t\t\t}\n\t\t});\n\t\treturn myFuture.wait();\n\t},\n\n\tmaintenanceToPdf : function(workId){\n\t\tthis.unblock();\n\n\t\tvar Future = Npm.require(\"fibers/future\");\n\t\tvar myFuture = new Future();\n\n\t\tvar currentUser = Meteor.user();\n\t\tvar work = Works.findOne(workId);\n\t\tif(!work){\n\t\t\tconsole.log(\"BUG_1\");\n\t\t\treturn false;\n\t\t}\n\t\tvar shop = Shops.findOne(work.shop._id);\n\t\tif(!shop){\n\t\t\tconsole.log(\"BUG_2\");\n\t\t\treturn false;\n\t\t}\n\n\t\tvar filename = shop.brand.replace(\" \", \"-\") + \"/\" + moment().format(\"YYYY-MM-DD\") + \"-maintenance-\" + workId + \".pdf\";\n\t\t\t\t\t\n\t\tvar dest = process.env.PWD + \"/.uploads/pdf/\";\n\n\t\tvar tasks =\t_(work.modules||[]).chain()\n\t\t\t\t\t.map(function(module){\n\t\t\t\t\t\treturn (module.tasks||[]).map(function(task){\n\t\t\t\t\t\t\treturn task.name;\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.flatten()\n\t\t\t\t\t.unique()\n\t\t\t\t\t.sort()\n\t\t\t\t\t.value();\n\t\tvar modules = \t_(work.modules||[]).chain()\n\t\t\t\t\t\t.map(function(module){\n\t\t\t\t\t\t\treturn _([\n\t\t\t\t\t\t\t\tmodule.serial||\"noSerial\",\n\t\t\t\t\t\t\t\ttasks\n\t\t\t\t\t\t\t\t.map(function(task){\n\t\t\t\t\t\t\t\t\ttask = _(module.tasks).chain().where({name: task}).first().value();\n\t\t\t\t\t\t\t\t\tif(_.isObject(task)){\n\t\t\t\t\t\t\t\t\t\tif(task.checked === true) return \"V\";\n\t\t\t\t\t\t\t\t\t\telse if(task.checked == null || task.checked == \"\") return \".\";\n\t\t\t\t\t\t\t\t\t\telse return task.checked\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse return \"\";\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]).flatten();\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.value();\n\t\t\n\t\tHTTP.call(\"GET\", \"http://pdftaf.ogre.be/ogre/maintenane.php\", {\n\t\t\tparams: {\n\t\t\t\tfilename : filename,\n\t\t\t\tdest : dest,\n\t\t\t\ttasks : JSON.stringify(tasks),\n\t\t\t\tmodules : JSON.stringify(modules)\n\t\t\t}\n\t\t}, function (error, result) {\n\t\t\tif(error) myFuture.throw(error);\n\t\t\tif(result.statusCode != 200) myFuture.throw(new Meteor.Error(\"statusCode-\"+result.statusCode));\n\t\t\ttry{\n\t\t\t\tWorks.update({\n\t\t\t\t\t_id:workId\n\t\t\t\t}, {\n\t\t\t\t\t$set : {\n\t\t\t\t\t\tsummary : file\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tmyFuture.return(result.data);\n\t\t\t}catch(e){\n\t\t\t\tmyFuture.throw(new Meteor.Error(\"non_valid_VAT\"));\n\t\t\t}\n\t\t});\n\n\t\t\n\t\treturn myFuture.wait();\n\t},\n\tworkToPdf : function(workId){\n\t\tthis.unblock();\n\n\t\tvar Future = Npm.require(\"fibers/future\");\n\t\tvar myFuture = new Future();\n\n\t\tvar currentUser = Meteor.user();\n\t\tvar work = Works.findOne(workId);\n\t\tif(!work){\n\t\t\treturn false;\n\t\t}\n\t\tvar wikis = Wikis.find({\n\t\t\t_id : {\n\t\t\t\t$in : (work.wikis || [])\n\t\t\t}\n\t\t}).fetch();\n\t\t\n\t\t\n\t\tvar pictures = Picts.find({\n\t\t\t_id : {\n\t\t\t\t$in : (work.pictures || [])\n\t\t\t}\n\t\t}).fetch();\n\n\n\t\tvar shop = Shops.findOne(work.shop._id);\n\t\tif(!shop){\n\t\t\treturn false;\n\t\t}\n\t\twork.workers = Workers.find({\n\t\t\t_id : {\n\t\t\t\t$in : _.keys(work.schedular)\n\t\t\t}\n\t\t}).fetch();\n\t\t\n\n\t\twork.workers = work.workers.map(function(worker){\n\t\t\tworker.schedular = work.schedular[worker._id];\n\t\t\treturn worker;\n\t\t});\n\n\t\tMeteor.pdfkitConfig.param.filename = shop.brand.replace(\" \", \"-\") + \"/\" + moment().format(\"YYYY-MM-DD\") + \"-\" + workId + \".pdf\"; \n\t\tvar pdf = new Meteor.pdfkit(Meteor.pdfkitConfig.param);\n\n\t\tpdf = Meteor.pdfkitConfig.templates(pdf);\n\t\tpdf\n\t\t.template(\"header\", process.env.PWD+\"/programs/web.browser/app/images/adf-logo.png\")\n\t\t.template(\"footer\", [{\n\t\t\tsize : 1.75,\n\t\t\t\ttext : [{\n\t\t\t\t\talign : \"left\",\n\t\t\t\t\tvalue : \"<b>Atelier</b>\\n\\nrue des technologies 2ter\\nB-4432 Alleur\"\n\t\t\t\t}],\n\t\t\t\tborder : false,\n\t\t\t},{\n\t\t\t\tsize : 1.75,\n\t\t\t\ttext : [{\n\t\t\t\t\talign : \"left\",\n\t\t\t\t\tvalue : \"<b>TÃ©lÃ©phone & Fax</b>\\n\\nFixe : 04 366.13.18\\nFax : 04 239.20.89\"\n\t\t\t\t}],\n\t\t\t\tborder : false,\n\t\t\t},{\n\t\t\t\tsize : 1.75,\n\t\t\t\ttext : [{\n\t\t\t\t\talign : \"left\",\n\t\t\t\t\tvalue : \"<b>Service Technique</b>\\n\\n1er : 0495.51.43.09\\n2nd : 0495.48.68.96\"\n\t\t\t\t}],\n\t\t\t\tborder : false,\n\t\t\t},{\n\t\t\t\tsize : 1.75,\n\t\t\t\ttext : [{\n\t\t\t\t\talign : \"left\",\n\t\t\t\t\tvalue : \"<b>Internet</b>\\n\\nMail : info@atelierdufroid.be\\nSite : www.atelierdufroid.be\"\n\t\t\t\t}],\n\t\t\t\tborder : false,\n\t\t\t}\n\t\t])\n\t\t.template(\"title\", [{\n\t\t\t\tsize : 1,\n\t\t\t\ttext : [{\n\t\t\t\t\talign : \"center\",\n\t\t\t\t\tvalue : \"/\",\n\t\t\t\t\tfolio : true\n\t\t\t\t}]\n\t\t\t},{\n\t\t\t\tsize : 4,\n\t\t\t\ttext : [{\n\t\t\t\t\talign : \"center\",\n\t\t\t\t\tvalue : \"Fiche de travail : \" + work.type\n\t\t\t\t}]\n\t\t\t}, {\n\t\t\t\tsize : 2,\n\t\t\t\ttext : [{\n\t\t\t\t\talign : \"center\",\n\t\t\t\t\tvalue : work._id\n\t\t\t\t}]\n\t\t\t}\n\t\t])\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\tsize :4, \n\t\t\t\ttext : [{ \n\t\t\t\t\talign : \"left\",\n\t\t\t\t\tvalue : \"Client : \"\n\t\t\t\t},{\n\t\t\t\t\talign : \"center\",\n\t\t\t\t\tvalue : s(shop.name+\" - \"+shop.brand).titleize()\n\t\t\t\t}]\n\t\t\t},{\n\t\t\t\tsize : 3,\n\t\t\t\ttext : [{ \n\t\t\t\t\talign : \"left\",\n\t\t\t\t\tvalue : \"Date rapport : \"\n\t\t\t\t},{\n\t\t\t\t\talign : \"center\",\n\t\t\t\t\tvalue : moment().format(\"DD/MM/YYYY\")\n\t\t\t\t}]\n\t\t\t}]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :4, \n\t\t\t\t\ttext : [{ \n\t\t\t\t\t\talign : \"left\",\n\t\t\t\t\t\tvalue : \"Adresse : \"\n\t\t\t\t\t},{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : s(shop.address.street+\" \"+shop.address.number+\", \" + shop.address.zipcode + \" \" + shop.address.city).titleize()\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize :3, \n\t\t\t\t\ttext : [{ \n\t\t\t\t\t\talign : \"left\",\n\t\t\t\t\t\tvalue : \"Heures dÃ©placement : \"\n\t\t\t\t\t},{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : moment.duration(shop.timeDist, \"seconds\").humanize()\n\t\t\t\t\t}]\n\t\t\t\t}]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :4, \n\t\t\t\t\ttext : [{ \n\t\t\t\t\t\talign : \"left\",\n\t\t\t\t\t\tvalue : \"Personne de contact : \"\n\t\t\t\t\t},{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : shop.contacts[0]\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}],\n\t\t\t\t\tborder : false\n\t\t\t\t}]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}],\n\t\t\t\t\tborder : false\n\t\t\t\t}]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}],\n\t\t\t\t\tborder : false\n\t\t\t\t}]\n\t\t})\n\t\t\n\t\t.template(\"newSection\", {})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"Heures prestÃ©es par technicien\"\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :3, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"<b>Nom technicien</b>\"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize :2, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"<b>Heure arrivÃ©e</b>\"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize :2, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"<b>Heure dÃ©part</b>\"\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\t\n\t\tvar scheduleLineCpt = 0;\n\t\twork.workers && work.workers.map(function(worker){\n\t\t\tworker.schedular.map(function(schedule, k ){\n\t\t\t\tscheduleLineCpt++;\n\t\t\t\tpdf.template(\"row\", {\n\t\t\t\t\tcontent : [{\n\t\t\t\t\t\tsize :3, \n\t\t\t\t\t\ttext : [{\n\t\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\t\tvalue : k === 0 ? s(worker.profile.firstname +\" \"+worker.profile.lastname).titleize().value() : \" - \"\n\t\t\t\t\t\t}]\n\t\t\t\t\t},{\n\t\t\t\t\t\tsize : 2, \n\t\t\t\t\t\ttext : [{\n\t\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\t\tvalue : moment(schedule.start).format(\"DD/MM HH:mm\")\n\t\t\t\t\t\t}]\n\t\t\t\t\t},{\n\t\t\t\t\t\tsize : 2, \n\t\t\t\t\t\ttext : [{\n\t\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\t\tvalue : moment(schedule.stop).format(\"DD/MM HH:mm\")\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\tfor( ; scheduleLineCpt < 7 ; scheduleLineCpt ++){\n\t\t\tpdf.template(\"row\", {\n\t\t\t\tcontent : [{\n\t\t\t\t\tsize :3, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize : 2, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize : 2, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}]\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\t\tpdf\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}],\n\t\t\t\t\tborder : false\n\t\t\t\t}]\n\t\t})\n\t\t.template(\"newSection\", {})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize : 7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"MatÃ©riaux\"\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize : 6, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\tbold : true,\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"<b>Description</b>\"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize : 1, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"<b>QuantitÃ©</b>\"\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\t\tvar mattersLineCpt = 0;\n\t\twork.matters && work.matters.map(function(matter){\n\t\t\tmattersLineCpt ++;\n\t\t\tpdf.template(\"row\", {\n\t\t\t\tcontent : [{\n\t\t\t\t\tsize : 6, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : s(matter.name).titleize().value()\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize : 1, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : matter.quantity+\" \"+matter.unit\n\t\t\t\t\t}]\n\t\t\t\t}]\n\t\t\t});\n\t\t});\n\t\tfor( ; mattersLineCpt < 7 ; mattersLineCpt ++){\n\t\t\tpdf.template(\"row\", {\n\t\t\t\tcontent : [{\n\t\t\t\t\tsize : 6, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize : 1, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}]\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\n\t\tpdf\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}],\n\t\t\t\t\tborder : false\n\t\t\t\t}]\n\t\t})\n\t\t\n\t\t.template(\"newSection\", {})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"Travaux rÃ©alisÃ©es : constatation, cause, action prise, remarque\"\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\n\t\tvar wikisLineCpt = 0;\n\t\twikis.map(function(wiki){\n\t\t\twikisLineCpt++;\n\t\t\tpdf\n\t\t\t.template(\"row\", {\n\t\t\t\tcontent : [{\n\t\t\t\t\tsize : 7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"left\",\n\t\t\t\t\t\tvalue : wiki.description\n\t\t\t\t\t}]\n\t\t\t\t}]\n\t\t\t});\n\t\t});\n\t\tfor( ; wikisLineCpt < 8 ; wikisLineCpt ++){\n\t\t\tpdf\n\t\t\t.template(\"row\", {\n\t\t\t\tcontent : [{\n\t\t\t\t\tsize : 7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}]\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n/*\n\t\tvar pictPerLine = 7 ; \n\t\tvar lines = pictures.length / pictPerLine;\n\n\t\tfor(var y = 0 ; y < lines ; y ++){\n\t\t\tpdf\n\t\t\t.template(\"row\", {\n\t\t\t\tcontent : [{\n\t\t\t\t\talign : \"center\",\n\t\t\t\t\tsize : 1, \n\t\t\t\t\timage : ( function(){\n\t\t\t\t\t\t\t\tvar images = []\n\t\t\t\t\t\t\t\tfor(var x = 0 ; x < pictPerLine ; x ++){\n\t\t\t\t\t\t\t\t\tvar id = x+(y*pictPerLine);\n\t\t\t\t\t\t\t\t\tif(id >=pictures.length )return images;\n\t\t\t\t\t\t\t\t\tvar src = pictures[id]\n\t\t\t\t\t\t\t\t\timages.push({\n\t\t\t\t\t\t\t\t\t\tsrc : _.isString(src) ? src : (process.env.PWD + \"/.uploads/\"+src.data.path)\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn images;\n\n\t\t\t\t\t\t\t})()\n\t\t\t\t}]\n\t\t\t})\n\t\t}*/\n\n\t\tpdf\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \" \"\n\t\t\t\t\t}],\n\t\t\t\t\tborder : false\n\t\t\t\t}]\n\t\t})\n\t\t\n\t\t.template(\"newSection\", {})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :7, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"Signature pour accord heures, matÃ©riaux, outillage\"\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t}).template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\t\tsize :3, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"left\",\n\t\t\t\t\t\tvalue : \"Client : \"\n\t\t\t\t\t},{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"Nom + Signature\"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize :2, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"Atelier du froid\"\n\t\t\t\t\t}]\n\t\t\t\t},{\n\t\t\t\t\tsize :2, \n\t\t\t\t\ttext : [{\n\t\t\t\t\t\talign : \"center\",\n\t\t\t\t\t\tvalue : \"ContrÃ´le Management\"\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t]\n\t\t})\n\t\t.template(\"row\", {\n\t\t\tcontent : [{\n\t\t\t\talign : \"center\",\n\t\t\t\tsize : 3, \n\t\t\t\timage : [{\n\t\t\t\t\tsrc : process.env.PWD + \"/.uploads/\"+work.signatures.client.path\n\t\t\t\t}]\n\t\t\t},{\n\t\t\t\talign : \"center\",\n\t\t\t\tsize : 2, \n\t\t\t\timage : [{\n\t\t\t\t\tsrc : process.env.PWD + \"/.uploads/\"+work.signatures.adf.path\n\t\t\t\t}]\n\t\t\t},{\n\t\t\t\talign : \"center\",\n\t\t\t\tsize : 2, \n\t\t\t\timage : [{\n\t\t\t\t\tsrc : process.env.PWD+\"/programs/web.browser/app/images/ADF-management.png\"\n\t\t\t\t}]\n\t\t\t}]\n\t\t});\n\n\t\tpdf\n\t\t.end(function(file){\n\t\t\tWorks.update({\n\t\t\t\t_id:workId\n\t\t\t}, {\n\t\t\t\t$set : {\n\t\t\t\t\tsummary : file\n\t\t\t\t}\n\t\t\t})\n\t\t\tmyFuture.return(file);\n\t\t});\n\t\treturn myFuture.wait();\n\t}\n});"]}