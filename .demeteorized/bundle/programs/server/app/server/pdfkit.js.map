{"version":3,"sources":["meteor://ðŸ’»app/server/pdfkit.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E","file":"/server/pdfkit.js","sourcesContent":["\"use strict\";\n/*global _ : false */\n/*global process : false */\n/*global Meteor : false */\n/*global Npm : false */\n\nMeteor.pdfkit = function(param){\n\tvar _param = {\n\t\tdest : process.env.PWD + \"/.uploads/pdf/\",\n\t\tfilename : \"default.pdf\",\n\t\tpage : {\n\t\t\tsize : \"A4\",\n\t\t\tmargins : {\n\t\t\t\tleft : 15,\n\t\t\t\ttop : 15,\n\t\t\t\tright : 15,\n\t\t\t\tbottom : 15\n\t\t\t},\n\t\t\tcolomn : 7\n\t\t},\n\t\tline : {\n\t\t\theight : 9,\n\t\t\tpadding : 2,\n\t\t\tmargin : 5\n\t\t},\n\t\tstroke : {\n\t\t\tbold : 2,\n\t\t\tthin : 0.2\n\t\t},\n\t\tfill : {\n\t\t\tgrey : \"#dedede\",\n\t\t\tblack : \"#000000\"\n\t\t},\n\t\tfonts : [{\n\t\t\t\tname : \"DejaVuSans\",\n\t\t\t\tfile : process.env.PWD + \"/public/fonts/dejavu/DejaVuSans.ttf\"\n\t\t\t},{\n\t\t\t\tname : \"DejaVuSans-Bold\",\n\t\t\t\tfile : process.env.PWD + \"/public/fonts/dejavu/DejaVuSans-Bold.ttf\"\n\t\t\t},{\n\t\t\t\tname : \"DejaVuSansMono\",\n\t\t\t\tfile : process.env.PWD + \"/public/fonts/dejavu/DejaVuSansMono.ttf\"\n\t\t\t},{\n\t\t\t\tname : \"DejaVuSansMono-Bold\",\n\t\t\t\tfile : process.env.PWD + \"/public/fonts/dejavu/DejaVuSansMono-Bold.ttf\"\n\t\t\t}]\n\t};\n\tparam = _.extend(_param, param);\n\tparam.dest += param.filename;\n\n\n\t//var PDFKit = Npm.require(\"pdfkit\");//PDFDocument\n\tvar doc = new PDFDocument({\n\t\tbufferPages: true,\n\t\tsize : param.page.size\n\t});\n\n\t//doc.pipe(fs.createWriteStream(param.dest));\n\n\tparam.fonts.map(function(font){\n\t\tdoc.font(font.file, font.name);\n\t});\n\tdoc.page.margins = param.page.margins;\n\n\tvar _templates = {};\n\n\tdoc.param = param;\n\n\tdoc.oogre = {\n\t\tposition : [0, 0],\n\t\tusedWidth : doc.page.width - doc.page.margins.left - doc.page.margins.right,\n\t\tcolWidth : (doc.page.width - doc.page.margins.left - doc.page.margins.right) / param.page.colomn,\n\t\tsetGet : function(name, data, position){\n\t\t\tif(!this[name]){\n\t\t\t\tthis[name] = {\n\t\t\t\t\tdata : data,\n\t\t\t\t\tposition : position\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn this[name];\n\t\t},\n\t\tfooter : false\n\t};\n\n\n\n\t/*\n\t\tvar maxDocY = doc.page.height - doc.page.margins.bottom;\n\t\tvar _dataTitle = false;\n\t\tvar _dataFooter = false;\n\t\tvar _dataHeader = false;\n\t\tvar _dataFolio = false;\n\t*/\n\t\n\treturn {\n\t\tdoc : function(){\n\t\t\treturn doc;\n\t\t},\n\t\tend : function(next){\n\t\t\tvar fs = Npm.require(\"fs\");\n\t\t\tvar dirpath  = param.dest.split(\"/\");\n\t\t\tdirpath.pop();\n\t\t\tdirpath = dirpath.join(\"/\");\n\t\t\t\n\t\t\tvar checkDir = fs.statSync(process.env.PWD);\n\t\t\tconsole.log(dirpath);\n\t\t\ttry{\n\t\t\t\tfs.mkdirSync(dirpath, checkDir.mode);\n\t\t\t}catch(e){\n\t\t\t\tif(e.code == \"EEXIST\");\n\t\t\t}\n\t\t\tdoc.writeSync(param.dest);\n\t\t\tvar url = \"/upload/pdf/\"+param.filename;\n\t\t\treturn _.isFunction(next) ? next(url) : url;\n\t\t},\n\t\tgetUrl : function(){\n\t\t\treturn param.dest;\n\t\t},\n\t\ttemplate : function(){\n\t\t\tvar name;\n\t\t\tif(arguments.length === 0){\n\t\t\t\treturn _templates;\n\t\t\t}\n\t\t\telse if(arguments.length == 1){\n\t\t\t\tname = arguments[0];\n\t\t\t\tif(_.isString(name)){\n\t\t\t\t\treturn _templates[name];\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(arguments.length == 2){\n\t\t\t\tif(_.isString(arguments[0])){\n\t\t\t\t\tname = arguments[0];\n\t\t\t\t\tif(_.isFunction(arguments[1])){\n\t\t\t\t\t\tvar template = arguments[1];\n\t\t\t\t\t\t_templates[name] = template;\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\t\t\t\t\telse if(_.isFunction(_templates[name])){\n\t\t\t\t\t\tvar fnc = _templates[name];\n\t\t\t\t\t\tvar data = arguments[1];\n\t\t\t\t\t\tfnc(doc, data);\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n};"]}