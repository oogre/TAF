{"version":3,"sources":["meteor://ðŸ’»app/server/publications.js"],"names":[],"mappings":"yBAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G","file":"/server/publications.js","sourcesContent":["\"use strict\";\n/*global _ : false */\n/*global Shops : false */\n/*global Wikis : false */\n/*global Works : false */\n/*global Roles : false */\n/*global Tasks : false */\n/*global Units : false */\n/*global Picts : false */\n/*global Meteor : false */\n/*global moment : false */\n/*global Matters : false */\n/*global Workers : false */\n/*global Modules : false */\n\nMeteor.startup(function () {\n\tMeteor.publish(\"shops\", function() {\n\t\treturn(Shops.find({}));\n\t});\n\tMeteor.publish(\"picts\", function() {\n\t\treturn Picts.find({});\n\t});\n\tMeteor.publish(\"mattersOriginsUnits\", function() {\n\t\treturn [Matters.find({}), Origins.find({}), Units.find({}), Moves.find({})];\n\t});\n\tMeteor.publish(\"workers\", function() {\n\t\treturn Workers.find({});\n\t});\n\tMeteor.publish(\"works&wikis\", function(date) {\n\t\tvar start = moment(date).subtract(1, \"month\").toISOString();\n\t\tvar stop = moment(date).add(1, \"month\").toISOString();\n\t\tvar works =\tWorks\n\t\t\t\t\t.find({\n\t\t\t\t\t\t$or : [{\n\t\t\t\t\t\t\trdv : {\n\t\t\t\t\t\t\t\t$gte: start,\n\t\t\t\t\t\t\t\t$lte: stop\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},{\n\t\t\t\t\t\t\tend : {\n\t\t\t\t\t\t\t\t$exists: false\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},{\n\t\t\t\t\t\t\tend : \"\"\n\t\t\t\t\t\t},{\n\t\t\t\t\t\t\tend : {\n\t\t\t\t\t\t\t\t$gte: start,\n\t\t\t\t\t\t\t\t$lte: stop\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\tvar wikis = Wikis.find({\n\t\t\t\t\t\t_id : {\n\t\t\t\t\t\t\t$in : \t_(works.fetch())\n\t\t\t\t\t\t\t\t\t.chain()\n\t\t\t\t\t\t\t\t\t.pluck(\"wikis\")\n\t\t\t\t\t\t\t\t\t.flatten()\n\t\t\t\t\t\t\t\t\t.without(undefined, null)\n\t\t\t\t\t\t\t\t\t.value()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\treturn [works, wikis];\n\t});\n\tMeteor.publish(\"roles\", function() {\n\t\treturn Roles.find({});\n\t});\n\tMeteor.publish(\"tasks\", function() {\n\t\treturn Tasks.find({});\n\t});\n\tMeteor.publish(\"modules\", function() {\n\t\treturn Modules.find({});\n\t});\n});"]}